<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo - Clínica Elizabeth Cruz</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="padding: 20px; background: #f4f4f4;">

    <script>
        // 1. PROTEÇÃO DE ACESSO (Deve ser a primeira coisa no body)
        const senhaDefinida = "1234";
        const entrada = prompt("Área Restrita. Digite a senha de acesso:");

        if (entrada !== senhaDefinida) {
            alert("Senha incorreta!");
            window.location.href = "/"; // Redireciona para a home
        }
    </script>

    <div class="container" style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 20px;">
        <h2 style="color: #D4AF37; font-family: 'Playfair Display';">Agendamentos Recebidos</h2>
        
        <div style="overflow-x: auto; margin-top: 20px;">
            <table id="tabela-admin" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #D4AF37; color: white;">
                        <th style="padding: 12px; text-align: left;">Data</th>
                        <th style="padding: 12px; text-align: left;">Cliente</th>
                        <th style="padding: 12px; text-align: left;">Telefone</th>
                        <th style="padding: 12px; text-align: left;">Mensagem</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // 2. LÓGICA DE CARREGAMENTO DOS DADOS
        async function carregarDadosAdmin() {
            try {
                const res = await fetch('/api/listar-contatos');
                const agendamentos = await res.json();
                
                const corpoTabela = document.querySelector("#tabela-admin tbody");
                corpoTabela.innerHTML = ""; 

                // Mostra os mais recentes no topo
                agendamentos.reverse().forEach(cli => {
                    const linha = `
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;">${cli.data_envio || '---'}</td>
                            <td style="padding: 10px; font-weight: bold;">${cli.nome}</td>
                            <td style="padding: 10px;">${cli.telefone}</td>
                            <td style="padding: 10px; color: #666;">${cli.mensagem}</td>
                        </tr>
                    `;
                    corpoTabela.innerHTML += linha;
                });
            } catch (err) {
                console.error("Erro ao carregar:", err);
            }
        }

        // Executa a carga dos dados após a verificação da senha
        carregarDadosAdmin();
    </script>
</body>
</html>